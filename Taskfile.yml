version: "3"

tasks:
  hcltest:
    aliases:
      - build
    desc: Builds the executable
    sources:
      - go.*
      - '*.go'
    generates:
      - hcltest
    cmd: go build
  test:
    desc: Runs a basic test
    deps:
      - hcltest
    cmds:
      - diff <(./hcltest --vars testdata/variables.hcl testdata/test.hcl --output json) testdata/expected.json
      - diff <(./hcltest --vars testdata/variables.hcl testdata/test.hcl --output hcl) testdata/expected.hcl
  clean:
    desc: removes generated files
    ignore_error: true
    cmds:
      - rm hcltest
